apiVersion: v1
kind: Pod
metadata:
  name: {{ template "kiam.fullname" . }}-tests
  annotations:
    "helm.sh/hook": test-success
    iam.amazonaws.com/role: {{ .Values.tests.expectedAssumedRole }}
spec:
   {{- if .Values.agent.nodeSelector }}
  nodeSelector:
{{ toYaml .Values.agent.nodeSelector | indent 4 }}
    {{- end }}
  containers:
  - name: {{ .Release.Name }}-tests
    image: "{{ .Values.tests.image.repository }}:{{ .Values.tests.image.tag }}"
    imagePullPolicy: {{ .Values.tests.image.pullPolicy | quote }}
    command: ["/usr/bin/aws", "sts", "get-caller-identity"]
  restartPolicy: Never